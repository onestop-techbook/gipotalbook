# Hasuraを構築する（モブ#12 7/30)

連休やなんやらで少しあきましたが、今日はHasuraを構築し、実際にページとして表示します。

みんなで使えるGraphQLサーバーを立ててみましょう。

Hasura.cloudというのはあるのですが、月99ドルからなので現実的ではありません。ローカルで立ててもデプロイの問題が出てくるので、Herokuでやってみます。

規模が難しいとか何か機能として無理になるとかの問題が生じたらその時考えることにしましょう。

## Herokuをみてみる
Herokuでやってみることにします。まずは、料金などの確認です。ギポタルでチームを作ります。５ユーザーまでは無料のチームが作れるようです。ただし、クレカ登録が必要です。一旦かからないけど、チーム人数が超えた時などに請求される形だと考えられます。

とりあえず、いまは個人IDで動作の練習とデプロイを確認してみます。まずは、ID作って、ログインをします。

### GraphQLをデプロイする
HasuraからHerokuにデプロイするチュートリアルがあり、その中にデプロイするボタンがあるので、ここからデプロイします。

https://hasura.io/docs/1.0/graphql/manual/deployment/deployment-guides/heroku.html

とりあえずギポタルに干渉しない名前をつけておいて、Deploy appをクリックすると、デプロイされます。Dockerのログが走り、しばらくすると完了し、Hasuraのコンソールが見れるようになります。

無料プランではHerokuの資源が若干貧弱なため起動には多少時間がかかりますが、Hasuraのコンソールが見れれば完了です。本当にワンクリックでできたよ、とみんなから驚きの声も。

あとは、Hasuraの画面からテストデータを作ります。Add new tableから模擬データを作ります。この辺りは、過去のモブでやったところですね。

ところでここで、データタイプの型にName型というのがあることに気づき、なんじゃこりゃ、とう話も出ます。まあテキストでいいですよね。となります。

idとnameを適当に作って模擬データとします。たくさんありすぎても仕方ないので、二つ三つです。

そして、GraphQLのURLをコピーして、VS codeのindex.tsの中にある、URLを書き換えます。

Next.jsの画面を更新すると、データが読み込まれ、先ほど入力したデータが表示されれば成功です。

万全を期すなら、Hasuraにデータを追加して、再度更新してそれも追加表示されることを書くにすれば万全です。

### GraphQLのURLを隠す
このGraphQLは表示して良いものでしょうか？不用意なアクセスによるセキュリティリスクもありますから、隠すことも検討します。とりあえず隠匿できるように。.env設定もやってみます。

プロジェクトのルートに.envというファイルを作ります。

GRAPHQL_URL = "https://hoge.heroku/hoge"


