#　DBテーブル石器をする(8月20日)

今回は個別ワークとして、人数少な目ですがデータベースのテーブル設計を進めます。

参加者は、FORTE、モウフカブール(大澤)。もっとです。

## テーブル一覧を作る

まずは、テーブルの一覧として必要なものを列挙します。親ともいえるものですね。

* サークル
* 頒布物
* イベント
* タグ

これをもとに、テーブル設計を進めていきます。最初に、スプレッドシートに枠を作ります。日本語での説明、カラム名、型、主キーになるものを決めるフラグ、Null許可のフラグを設定します。

具体的には、シートを見たほうが早いでしょう。議論の経緯は別途記載しますが、できあがったサークルテーブルは次の図のようになります。


![設計したテーブル](chap-mob-0826/tableexample.png?scale=0.8)

idというカラム名があり、データベースのカラム名(インデックスとして)  idがあります。その型はText型です。また、サークルを一意に選択する他の主キーになるものですがから、主キーのフラグが立ちます。当然、Null不可(未記入は不可)です。

一つ具体的に書いてみると、要件がはっきりしますね。

過去(7月2日)に整理した同人誌テーブルから必要な要素を持ってきます。

抜け漏れを防ぐために、拾ったものは枠をつける形でチェックしながら進めます。

ところで、現時点ではMVP(Minimum Viable Product)を作るにあたって必要なものだけにするのか、今後追加する可能性があるのはあらかじめ手いれておくのかという議論が生まれました。

一旦は、ページにあるものだけとすることで進めることにします。追加は面倒といえば面倒ですが、複雑になり設計が遅れてしまうことはMVPの目指すところではありません。

そして出来上がったのが、先のテーブルです。

サークル名は必須なので、Null不可とします。サークル紹介文はdescriptionという名前にして、Null可です。サークル紹介文を書かない人はまずいませんが、記入がないからといって、実装上困るわけではありませんからNull可です。



#### [column] 命名規則について
命名規則についての話が出てきます。カラム名をどうつけるのか、単数形なのか複数形なのか、大文字始まりなのか全小文字なのか、キャメルケースとするのか、などのお作法についてです。

Ruby on Railsでは、複数形を使うことが多く、型がある言語では単数形を使うことが多い等のもやっとしたお作法があるようです。

もちろんあとから任意に変えることはできますし、Hasuraに載せるときにHasura推奨の形に変換するとして、一旦は、小文字、スネークケース、複数形として進めます。

こういうお作法についても知ることができるのはモブの利点ですね

#### [/column]

# サークルURL
つぎは、サークルに紐づくURLです。これは、サークルに紐づく情報ではありますが、別テーブルとして追加します。最初に4つといったテーブルが増えることになりますが、設計の結果ですからOKです。

サークルリンクは、サークルのTwitterやBOOTHなどの販売サイトなどが格納される想定です。

サークルとの紐づけのためのidがあります。

TwitterやBOOTHなどいくつかのURLが存在しますが、リンク名が必要かどうか、表示順序が必要か、という議論が出ます。

デザインとして、順番決め打ち(Twitter,Facebook,BOOTHと決め打ちにするのか、並べ替えを許容するのかです)。order_numを作って、表示順をユーザーに決めてもらえるようにし、リンク種別を任意にするということも可能といえば可能です。

しかし今回は、デザイン的にも、テーブル設計的にも相当面倒になるので、順序・デザイン決め打ちで、アイコンのみ表示とします。

表示名(XXサークル公式、公式Blog等)は表示できないという形になります。若干自由度は下がりますが、コントロール、設計はしやすくなります。

入力ページの作成も楽になります。また、同じ種別の複数登録もなしです。Twitterアイコンが2個並ぶとかはやりたくないので、不許可です。サークルIDとリンク種別でユニークにできます。

入力ページと表示ページのイメージは図のようになります。シンプルですね。(アイコンや文字のデザインは適当です)

たいていのサークルは十分なのですが、本人IDとサークルIDを分けている場合などはちょっと困る例が出てくる可能性がありますね。親方Project、たぬてっく、モウフカブールなど、関係者にエッジケースが多いのはきっと気のせいです。

idとリンク種別でユニークのフラグを立てておきます。

URL、各SNSについてはこれで完了です。

